<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Drill Beats</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        /* All base styles are the same and correct, condensed for brevity */
        html{font-size:90%}body{margin:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background-color:#121212;color:#e0e0e0}.background-container{width:90%;max-width:1100px;margin:30px auto;background-color:#1e1e1e;background-image:url(images/background.jpg);background-size:cover;background-position:center;border-radius:15px;box-shadow:0 0 20px rgba(0,0,0,.5);padding:20px 40px}.header{display:flex;justify-content:space-between;align-items:center;padding-bottom:20px;border-bottom:1px solid #333}.header h1{color:#e53935;margin:0;font-size:1.8em;text-transform:uppercase;letter-spacing:1px}.login-signup-area a{color:#e0e0e0;text-decoration:none;margin-left:15px;padding:8px 15px;border:1px solid #e53935;border-radius:5px;cursor:pointer;transition:all .3s ease;box-shadow:0 2px 4px rgba(0,0,0,.3)}.login-signup-area a:hover{background-color:#e53935;color:#fff;box-shadow:0 4px 8px rgba(0,0,0,.5)}#user-status{display:none;align-items:center;gap:15px}#user-status span{font-weight:700}h2{color:#e53935;border-bottom:2px solid #e53935;padding-bottom:10px;margin-top:30px}.featured-beats-list{min-height:100px;display:flex;gap:20px;padding:15px;flex-wrap:wrap;justify-content:center}.featured-beat-item{flex-shrink:0;width:220px;height:120px;background-color:#2c2c2c;padding:15px;border-radius:10px;text-align:center;border:1px solid #e53935;box-shadow:0 4px 8px rgba(0,0,0,0.4);position:relative;display:flex;flex-direction:column;justify-content:space-between;background-size:cover;background-position:center;}.featured-beat-item::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);border-radius:10px;}.featured-beat-item > * {position:relative;z-index:2;}.featured-beat-item:nth-of-type(1){background-image: url('images/featured/feature1.jpg');}.featured-beat-item:nth-of-type(2){background-image: url('images/featured/feature2.jpg');}.featured-beat-item:nth-of-type(3){background-image: url('images/featured/feature3.jpg');}.featured-beat-item .song-name{font-weight:700;font-size:1.1em;color:#fff;text-shadow:1px 1px 3px #000;}
        .beat-list-container{max-height: 580px; overflow-y: auto; padding-right: 10px; margin-top: 20px;}
        .beat-list{min-height:100px;display:flex;flex-direction:column;gap:15px}
        .beat-item{display:grid;grid-template-columns:1fr auto auto auto auto;align-items:center;background-color:#2c2c2c;padding:15px;border-radius:10px;transition:background-color .3s}.beat-item:hover{background-color:#383838}.beat-item.sold-out .song-name{text-decoration:line-through;text-decoration-color:#e53935;opacity:0.6;}.beat-item .song-name{font-size:1.2em;font-weight:700;text-align:left}.beat-item .button,.featured-beat-item .button{background:0 0;border:none;color:#e0e0e0;cursor:pointer;font-size:24px;margin:0 5px;padding:5px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:color .3s}.beat-item .button:hover,.featured-beat-item .button:hover{color:#e53935}.buy-lease-button{background-color:#e53935;color:#fff;padding:8px 20px;border-radius:5px;text-decoration:none;font-weight:700;font-size:16px;margin-left:10px;transition:all .3s ease;box-shadow:0 2px 4px rgba(0,0,0,.3); border: none; cursor: pointer;}.buy-lease-button:hover{background-color:#c42724;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.5)}.like-container{display:flex;align-items:center;gap:5px;min-width:60px}.like-button.liked .material-icons{color:#e53935}.modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);justify-content:center;align-items:center;z-index:1000}.modal-content{background:#2c2c2c;padding:30px;border-radius:10px;width:90%;max-width:550px;box-shadow:0 5px 15px rgba(0,0,0,.5);position:relative}.modal-close{position:absolute;top:10px;right:15px;font-size:28px;font-weight:700;color:#fff;cursor:pointer}.modal-content h3{color:#e53935;text-align:center;margin-top:0}.auth-form{display:flex;flex-direction:column;gap:15px}.auth-form input{background:#1e1e1e;border:1px solid #555;border-radius:5px;padding:12px;color:#fff;font-size:16px}.auth-form input:focus{outline:0;border-color:#e53935}.form-buttons{display:flex;gap:10px;justify-content:center;margin-top:10px}.form-buttons button{flex:1;padding:12px;border:none;border-radius:5px;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s ease;box-shadow:0 2px 4px rgba(0,0,0,.3)}.form-buttons button:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.5)}#signup-action-btn{background-color:#e53935;color:#fff}#signup-action-btn:hover{background-color:#c42724}#login-action-btn{background-color:#555;color:#fff}#login-action-btn:hover{background-color:#777}#auth-error{color:#ff8a80;text-align:center;margin-top:15px;font-weight:700;display:none}.auth-separator{text-align:center;color:#888;margin:15px 0}#google-btn{display:flex;align-items:center;justify-content:center;gap:10px;background:#222;color:#fff;border:1px solid #555;width:100%}#google-btn:hover{background:#333}
        .lease-options{display:grid;gap:15px;margin-top:20px;}.lease-option{display:grid;grid-template-columns:1fr auto;grid-template-rows:auto auto;align-items:center;background:#1e1e1e;padding:15px 20px;border-radius:8px;border:1px solid #e53935;}.lease-option.exclusive{position:relative;box-shadow:0 0 15px rgba(255,255,255,0.4);}.lease-info{grid-column:1 / 2;}.lease-info h4{margin:0;font-size:1.2em;}.lease-info p{margin:5px 0 0;color:#aaa;font-size:0.9em;}.lease-price{grid-column:2 / 3;grid-row:1 / 3;background:#2f2f2f;padding:15px;border-radius:8px;text-align:center;}.lease-price .price{font-size:1.6em;font-weight:bold;margin:0;}.lease-price .buy-now-btn{background:#e53935;color:#fff;padding:8px 15px;margin-top:10px;border-radius:5px;border:none;cursor:pointer;font-weight:bold;transition:background .3s;}.lease-price .buy-now-btn:hover{background:#c42724;}.share-modal-content{text-align:center;}.share-modal-content h3{margin-bottom:25px;}.share-links{display:flex;justify-content:center;gap:20px;flex-wrap:wrap;}.share-link{display:flex;flex-direction:column;align-items:center;text-decoration:none;color:#fff;width:80px;}.share-link .material-icons{font-size:48px;transition:transform .2s;}.share-link:hover .material-icons{transform:scale(1.1);color:#e53935;}.share-link span{margin-top:5px;}
        .tooltip{position:relative;display:inline-flex;align-items:center;}.tooltip .tooltip-icon{font-size:1.2em;margin-left:8px;color:#888;cursor:help;}.tooltip .tooltip-text{visibility:hidden;width:250px;background-color:#1e1e1e;color:#fff;text-align:center;border-radius:6px;padding:10px;position:absolute;z-index:1;bottom:125%;left:50%;margin-left:-125px;opacity:0;transition:opacity .3s;border:1px solid #555;}.tooltip:hover .tooltip-text{visibility:visible;opacity:1;}
        .welcome-blurb{padding:15px 20px;background-color:#2c2c2c;border-radius:10px;margin-bottom:20px;border-left:4px solid #e53935;}.welcome-blurb p{margin:0;line-height:1.6;}
        .all-beats-header{display:flex;justify-content:space-between;align-items:center;}
        .sort-options button{background:none;border:1px solid #555;color:#e0e0e0;padding:5px 10px;margin-left:5px;border-radius:5px;cursor:pointer;transition:all .3s ease;}.sort-options button:hover,.sort-options button.active{background-color:#e53935;border-color:#e53935;color:#fff;}
        footer{text-align:center;margin-top:40px;padding-top:20px;border-top:1px solid #333;color:#888;font-size:0.9em;} footer a{color:#e53935;text-decoration:none;}
    </style>
</head>
<body>
    <div class="background-container">
        <header class="header"><h1>UK Drill Beats</h1><div class="login-signup-area"><div id="logged-out-view"><a id="login-btn">Log In</a><a id="signup-btn">Sign Up</a></div><div id="user-status"><span id="user-email"></span><a id="logout-btn">Log Out</a></div></div></header>
        <main>
            <div class="welcome-blurb"><p>Browse the latest UK Drill instrumentals. Press play to hear a 30-second preview. Like and share your favourites. Purchase an exclusive lease to own the beat forever â€” first come, first served.</p></div>
            <section class="featured-beats">
                <h2 class="tooltip">Featured Beats <span class="tooltip-icon material-icons">help_outline</span><span class="tooltip-text">Used one of our beats in your track? Get it featured here! Submit your work to dreamhiveofcl@gmail.com for consideration.</span></h2>
                <div class="featured-beats-list" id="featured-beats-list"></div>
            </section>
            <section class="all-beats">
                <div class="all-beats-header">
                    <h2>All Beats</h2>
                    <div class="sort-options" id="sort-options"><button data-sort="newest" class="active">Newest</button><button data-sort="az">A-Z</button><button data-sort="za">Z-A</button></div>
                </div>
                <div class="beat-list-container"><div class="beat-list" id="all-beats-list"></div></div>
            </section>
        </main>
        <footer><p>&copy; <span id="copyright-year"></span> Dream Hive. All original concepts, beats, and content are the intellectual property of Dream Hive and its creator. Unauthorized use or reproduction is prohibited.</p></footer>
    </div>
    <div class="modal-overlay" id="auth-modal"><div class="modal-content"><span class="modal-close" id="modal-close-btn-auth">&times;</span><h3 id="modal-title">Welcome</h3><form class="auth-form" onsubmit="return false;"><input type="email" id="auth-email" placeholder="Email" required><input type="password" id="auth-password" placeholder="Password (min. 6 characters)" required><div class="form-buttons"><button type="button" id="login-action-btn">Log In</button><button type="button" id="signup-action-btn">Sign Up</button></div><p id="auth-error"></p><div class="auth-separator">or</div><button type="button" id="google-btn" class="form-buttons"><span class="material-icons">login</span>Continue with Google</button></form></div></div>
    <div class="modal-overlay" id="lease-modal"><div class="modal-content"><span class="modal-close" id="modal-close-btn-lease">&times;</span><h3 id="lease-title">Purchase Lease</h3><div id="lease-options-container" class="lease-options"></div><div style="font-size:0.8em;color:#aaa;text-align:center;margin-top:15px;"><p>All purchases are subject to our standard lease agreement. A copy will be included with your download.</p></div></div></div>
    <div class="modal-overlay" id="share-modal"><div class="modal-content share-modal-content"><span class="modal-close" id="modal-close-btn-share">&times;</span><h3 id="share-title">Share Beat</h3><div id="share-links-container" class="share-links"></div></div></div>

    <script type="module">
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-functions.js";
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, GoogleAuthProvider, signInWithPopup, signInWithRedirect, getRedirectResult } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, increment, collection, query, where, getDocs, writeBatch, deleteDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
        
        const firebaseConfig={apiKey:"AIzaSyCkXeTXEZ-VpAAKr5aMY3iTuZCW330aMUQ",authDomain:"dream-hive-uk-drill-beats.firebaseapp.com",projectId:"dream-hive-uk-drill-beats",storageBucket:"dream-hive-uk-drill-beats.appspot.com",messagingSenderId:"817848550593",appId:"1:817848550593:web:7dbadc392729127c8d4040",measurementId:"G-HPKZYPMX3G"};
        const app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app),functions=getFunctions(app, "europe-west2");
        const stripe = Stripe('pk_live_51RuPZUGyqAmgk6UpPtu7LLA5beoFIYboPeHYAEGVmp1gQHacdV3Dvf7xslexTm2l7UeBurm2rNR4UQNpM8YL07Uv00yW06dLTd');
        let currentUser=null,userLikes=new Map(),allBeatsData=[],featuredBeatsData=[],currentAudio=null,currentPlayButton=null,stopTimer=null;
        const leaseModal=document.getElementById("lease-modal"),shareModal=document.getElementById("share-modal");
        
        function showLeaseModal(beat){if(beat.isSold)return;document.getElementById("lease-title").textContent=`Purchase: ${beat.songName}`;const container=document.getElementById("lease-options-container");const leases={mp3:{name:"MP3 Lease",desc:"High-quality MP3 file for promotional use.",price:100,priceDisplay:"$1.00"},wav:{name:"WAV Lease",desc:"Uncompressed WAV file, the industry standard.",price:4999,priceDisplay:"$49.99"},exclusive:{name:"Exclusive Rights",desc:"The beat is yours. It will be removed from the store forever.<br><strong style='color:#e53935;margin-top:5px;display:block;'>Includes MP3 and WAV files. The beat will be marked 'SOLD'.</strong>",price:29999,priceDisplay:"$299.99"}};container.innerHTML=Object.entries(leases).map(([key,lease])=>`<div class="lease-option ${key==="exclusive"?"exclusive":""}"><div class=lease-info><h4>${lease.name}</h4><p>${lease.desc}</p></div><div class=lease-price><p class=price>${lease.priceDisplay}</p><button class=buy-now-btn data-beat-id="${beat.id}" data-lease-type="${key}" data-price-cents="${lease.price}" data-song-name="${beat.songName}">Buy Now</button></div></div>`).join(""),leaseModal.style.display="flex"}
        async function checkout(beatId,leaseType,priceInCents,songName){if(!currentUser)return void alert("Please log in to purchase.");try{const createCheckoutSession=httpsCallable(functions,"createCheckoutSession"),result=await createCheckoutSession({beatId,leaseType,priceInCents,songName}),{id:sessionId}=result.data;await stripe.redirectToCheckout({sessionId})}catch(error){console.error("Could not create checkout session:",error),alert("Error: Could not connect to the payment server.")}}
        function showShareModal(beatId,songName){document.getElementById("share-title").textContent=`Share: ${songName}`;const url=new URL(window.location.href);url.searchParams.set("beat",beatId);const encodedUrl=encodeURIComponent(url.toString()),text=encodeURIComponent(`Check out this beat: ${songName}`);const links=[{name:"Copy Link",icon:"link",action:()=>{navigator.clipboard.writeText(url.toString()),alert("Link Copied!"),shareModal.style.display="none"}},{name:"X / Twitter",icon:"share",url:`https://twitter.com/intent/tweet?url=${encodedUrl}&text=${text}`},{name:"Facebook",icon:"share",url:`https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`},{name:"Reddit",icon:"share",url:`https://www.reddit.com/submit?url=${encodedUrl}&title=${text}`},{name:"WhatsApp",icon:"phone_iphone",url:`https://api.whatsapp.com/send?text=${text}%20${encodedUrl}`}];const container=document.getElementById("share-links-container");container.innerHTML=links.map(link=>link.url?`<a href=${link.url} target=_blank class=share-link><i class=material-icons>${link.icon}</i><span>${link.name}</span></a>`:`<a href=# class=share-link id=copy-link-btn><i class=material-icons>${link.icon}</i><span>${link.name}</span></a>`).join(""),document.getElementById("copy-link-btn")?.addEventListener("click",e=>{e.preventDefault(),links[0].action()}),shareModal.style.display="flex"}
        onAuthStateChanged(auth,async user=>{currentUser=user;if(user){document.getElementById("user-email").textContent=user.email,document.getElementById("user-status").style.display="flex",document.getElementById("logged-out-view").style.display="none",document.getElementById("auth-modal").style.display="none",await fetchUserLikes()}else document.getElementById("user-status").style.display="none",document.getElementById("logged-out-view").style.display="flex",userLikes.clear();renderAllBeats()});
        async function fetchUserLikes(){if(!currentUser)return;const q=query(collection(db,"likes"),where("userId","==",currentUser.uid)),querySnapshot=await getDocs(q);userLikes=new Map(querySnapshot.docs.map(doc=>[doc.data().beatId,doc.id]))}
        function playPreview(button,filePath){const icon=button.querySelector(".material-icons");if(currentPlayButton===button){currentAudio.pause();return}if(currentAudio)currentAudio.pause();currentAudio=new Audio(filePath),currentAudio.play(),icon.textContent="stop",currentPlayButton=button,stopTimer=setTimeout(()=>{if(currentPlayButton===button)currentAudio.pause()},30e3);const stopHandler=()=>{icon.textContent="play_arrow",currentPlayButton===button&&(currentPlayButton=null),clearTimeout(stopTimer)};currentAudio.addEventListener("pause",()=>{stopHandler(),currentAudio.currentTime=0}),currentAudio.addEventListener("ended",stopHandler)}
        async function handleLike(beatId){if(!currentUser)return void alert("Please log in to like beats!");const beatRef=doc(db,"beats",beatId),batch=writeBatch(db),hasLiked=userLikes.has(beatId);if(hasLiked){const likeDocId=userLikes.get(beatId),likeRef=doc(db,"likes",likeDocId);batch.delete(likeRef),batch.set(beatRef,{likeCount:increment(-1)},{merge:!0}),await batch.commit(),userLikes.delete(beatId)}else{const likeRef=doc(collection(db,"likes"));batch.set(beatRef,{likeCount:increment(1)},{merge:!0}),batch.set(likeRef,{userId:currentUser.uid,beatId:beatId}),await batch.commit(),userLikes.set(beatId,likeRef.id)}const beatToUpdate=allBeatsData.find(b=>b.id===beatId);beatToUpdate&&(beatToUpdate.likeCount=(beatToUpdate.likeCount||0)+(hasLiked?-1:1)),renderAllBeats()}
        
        let currentSort = "newest";
        function sortBeats(type) {
            currentSort = type;
            const sortButtons = document.querySelectorAll('#sort-options button');
            sortButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-sort="${type}"]`).classList.add('active');
            
            let sortedBeats = [...allBeatsData]; // Use a copy
            if (type === 'az') {
                sortedBeats.sort((a, b) => a.songName.localeCompare(b.songName));
            } else if (type === 'za') {
                sortedBeats.sort((a, b) => b.songName.localeCompare(a.songName));
            } // 'newest' is the default order from init()
            
            document.getElementById("all-beats-list").innerHTML = sortedBeats.map(createBeatItemHTML).join("");
        }

        function createBeatItemHTML(beat){const isLiked=userLikes.has(beat.id),soldClass=beat.isSold?"sold-out":"";return`<div class="beat-item ${soldClass}" data-beat-id="${beat.id}"><span class=song-name>${beat.songName}</span><button class="button play-button"><i class=material-icons>play_arrow</i></button><div class=like-container><button class="button like-button ${isLiked?"liked":""}"><i class=material-icons>favorite</i></button><span class=like-count>${beat.likeCount||0}</span></div><button class="button share-button"><i class=material-icons>share</i></button>${beat.isSold?`<button class="buy-lease-button" disabled style="background:#555;cursor:default">SOLD</button>`:`<button class=buy-lease-button>BUY LEASE</button>`}</div>`}
        function createFeaturedBeatHTML(beat){return`<div class=featured-beat-item data-beat-id=${beat.id} style="background-image: url('${beat.imagePath||""}')"><span class=song-name>${beat.songName}</span><button class="button play-button"><i class=material-icons style=font-size:48px>play_arrow</i></button></div>`}
        function renderAllBeats(){sortBeats(currentSort)}
        
        async function init(){try{const response=await fetch("beat-list.json?cachebust="+new Date().getTime());if(!response.ok)throw new Error("Could not fetch beat-list.json");const fileData=await response.json();const cleanId=songName=>songName.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");allBeatsData=fileData.allBeats.map(b=>({...b,id:cleanId(b.songName)})).reverse(),featuredBeatsData=fileData.featuredBeats.map(b=>({...b,id:cleanId(b.songName)})).reverse();const dataPromises=allBeatsData.map(async beat=>{const docRef=doc(db,"beats",beat.id),docSnap=await getDoc(docRef);if(docSnap.exists()){beat.likeCount=docSnap.data().likeCount||0,beat.isSold=docSnap.data().isSold||!1}return beat});allBeatsData=await Promise.all(dataPromises);
        renderAllBeats();const urlParams=new URLSearchParams(window.location.search);
        if(urlParams.get("purchase_success")==="true"&&urlParams.has("session_id")){const sessionId=urlParams.get("session_id");alert("Payment successful! Fetching your download link...");try{const getDownloadLink=httpsCallable(functions,"getDownloadLink"),result=await getDownloadLink({sessionId}),{downloadUrl}=result.data;window.location.href=downloadUrl}catch(e){console.error("Error fetching download link:",e),alert("We received your payment, but there was an error getting your download link. Please contact support.")}}else{const deepLinkedBeatId=urlParams.get("beat");if(deepLinkedBeatId){const beatToShow=allBeatsData.find(b=>b.id===deepLinkedBeatId);beatToShow&&showLeaseModal(beatToShow)}}}catch(e){console.error("Error loading beats:",e),document.getElementById("all-beats-list").innerHTML='<p style="text-align:center;padding:20px;">Could not load beats. Wait a moment and refresh.</p>'}}
        
        document.addEventListener("DOMContentLoaded",()=>{
            init();
            document.getElementById('copyright-year').textContent = new Date().getFullYear();
            const modal=document.getElementById("auth-modal"),authError=document.getElementById("auth-error"),emailInput=document.getElementById("auth-email"),passwordInput=document.getElementById("auth-password");
            document.getElementById("login-btn").addEventListener("click",()=>modal.style.display="flex");
            document.getElementById("signup-btn").addEventListener("click",()=>modal.style.display="flex");
            document.getElementById("modal-close-btn-auth").addEventListener("click",()=>{modal.style.display="none",authError.style.display="none"});
            document.getElementById("logout-btn").addEventListener("click",()=>signOut(auth));
            
            document.getElementById("signup-action-btn").addEventListener("click",async()=>{try{await createUserWithEmailAndPassword(auth,emailInput.value,passwordInput.value),authError.style.display="none"}catch(e){authError.textContent=e.message,authError.style.display="block"}});
            document.getElementById("login-action-btn").addEventListener("click",async()=>{try{await signInWithEmailAndPassword(auth,emailInput.value,passwordInput.value),authError.style.display="none"}catch(e){authError.textContent="Incorrect details. Please try again or sign up.",authError.style.display="block"}});
            document.getElementById("sort-options").addEventListener('click', (e) => { if(e.target.tagName === 'BUTTON') { sortBeats(e.target.dataset.sort); }});
            
            const googleProvider=new GoogleAuthProvider;googleProvider.setCustomParameters({prompt:"select_account"});const isIOS=/iPhone|iPad|iPod/.test(navigator.userAgent);async function signInWithGoogle(){try{isIOS?await signInWithRedirect(auth,googleProvider):await signInWithPopup(auth,googleProvider)}catch(e){if("auth/popup-blocked"===e.code||"auth/popup-closed-by-user"===e.code)return void await signInWithRedirect(auth,googleProvider);authError.textContent=e.message,authError.style.display="block"}}getRedirectResult(auth).catch(()=>{});document.getElementById("google-btn").addEventListener("click",signInWithGoogle);
            document.getElementById("modal-close-btn-lease").addEventListener("click",()=>leaseModal.style.display="none"),document.getElementById("modal-close-btn-share").addEventListener("click",()=>shareModal.style.display="none");
            leaseModal.addEventListener("click",e=>{const buyButton=e.target.closest(".buy-now-btn");if(buyButton){const{beatId,leaseType,priceCents,songName}=buyButton.dataset;checkout(beatId,leaseType,parseInt(priceCents),songName)}});
            const handleInteraction=(e,listData)=>{const playButton=e.target.closest(".play-button"),likeButton=e.target.closest(".like-button"),shareButton=e.target.closest(".share-button"),buyLeaseButton=e.target.closest(".buy-lease-button"),beatItem=e.target.closest("[data-beat-id]");if(!beatItem)return;const beatId=beatItem.dataset.beatId,beat=listData.find(b=>b.id===beatId);if(!beat)return;if(playButton)playPreview(playButton,beat.filePath);if(likeButton)handleLike(beat.id);if(shareButton)showShareModal(beat.id,beat.songName);if(buyLeaseButton)showLeaseModal(beat)};document.getElementById("all-beats-list").addEventListener("click",e=>handleInteraction(e,allBeatsData)),document.getElementById("featured-beats-list").addEventListener("click",e=>handleInteraction(e,featuredBeatsData));
        });
    </script>
</body>
</html>